(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/communitycard"],{2989:function(t,e,i){"use strict";i.r(e);var n=i("60fc"),o=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},"30dc":function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return n}));var n={uImage:function(){return i.e("uview-ui/components/u-image/u-image").then(i.bind(null,"2a28"))}},o=function(){var t=this,e=t.$createElement,i=(t._self._c,t._f("formatTimeYMD")(t.detail.create_time));t.$mp.data=Object.assign({},{$root:{f0:i}})},a=[]},"3ba6":function(t,e,i){"use strict";i.r(e);var n=i("30dc"),o=i("2989");for(var a in o)"default"!==a&&function(t){i.d(e,t,(function(){return o[t]}))}(a);i("71f0");var s,c=i("f0c5"),r=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"0a0c4451",null,!1,n["a"],s);e["default"]=r.exports},"60fc":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){i.e("components/onshare/onshare").then(function(){return resolve(i("b185"))}.bind(null,i)).catch(i.oe)},o=function(){i.e("components/onfirend/onfirend").then(function(){return resolve(i("763a"))}.bind(null,i)).catch(i.oe)},a=function(){Promise.all([i.e("common/vendor"),i.e("wxcomponent/hch-poster/hch-poster")]).then(function(){return resolve(i("0aaf"))}.bind(null,i)).catch(i.oe)},s=function(){i.e("components/struggler-navigationCustom/navigation-custom").then(function(){return resolve(i("e7f2"))}.bind(null,i)).catch(i.oe)},c={data:function(){return{config:{title:"小区名片",bgcolor:"white",fontcolor:"rgba(51, 51, 51, 1)",type:1,transparent:!1,linear:!0,share:!1},scrollTop:0,scrollMaxHeight:200,detail:{},community_id:"",indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,indicatorColor:"rgba(255, 255, 255, 1)",indicatorActiveColor:"rgba(255, 156, 0, 1)",deliveryFlag:!1,canvasFlag:!0,scrollFixed:!1,posterData:{marginLR:30,marginTB:80,radius:.03,innerLR:20,innerTB:20,posterRatio:1.3,posterImgUrl:"",title:"",titleFontSize:15,desFontSize:14,desLineHeight:22,titleLineHeight:24,posterCodeUrl:"https://sq.wenlinapp.com/upload/share/20200821/20200821233746683.png",codeWidth:.3,codeRatio:1,codeRadius:.5,codeMT:15,codeName:"问邻",codeNameMT:15,tips:"长按/扫描识别加入小区",posterBgUrl:"",avatarUrl:t.getStorageSync("user").avatar,des:""},simpleFlag:!1,openCommunity:!1,mobile:"",communityAddress:"",communityTitle:"",setcommunity:!1,textread:"《问邻服务协议及隐私政策》",community:"",building:"",unit:1,pickerId:!1,picker:[{value:1,label:"业主"},{value:2,label:"亲友"},{value:3,label:"租客"}],pickerValue:0,communityId:"",setcommunityType:1,setcommunityValue:"业主",onShareShow:!1}},onLoad:function(t){console.log(t,"options")},mounted:function(){console.log(this.$mp.query),this.community_id=this.$mp.query.community_id,this.$mp.query.community_id&&(t.setStorageSync("pid",this.$mp.query.pid),t.setStorageSync("pcommunity_id",this.community_id));var e=decodeURIComponent(this.$mp.query.scene);if(console.log(e),this.$mp.query.scene){e=decodeURIComponent(this.$mp.query.scene);console.log(e);var i=e.split("&"),n="",o="";"community_id"==i[0].split("=")[0]?(n=i[0].split("=")[1],o=i[1].split("=")[1],this.community_id=n,t.setStorageSync("pcommunity_id",n),t.setStorageSync("pid",o)):(n=i[1].split("=")[1],o=i[0].split("=")[1],t.setStorageSync("pid",o),t.setStorageSync("pcommunity_id",n))}this.getDetail(),this.mobile=t.getStorageSync("mobile")},onShareAppMessage:function(){var e=this.community_id,i=t.getStorageSync("user_id");return{title:t.getStorageSync("user").user_nickname+"邀请你加入"+this.detail.title+"小区，与邻居们一起共建共享小区",imageUrl:this.detail.images&&this.detail.images.length?this.detail.images[0]:"https://sq.wenlinapp.com/appimg/send54.png",path:"/pages/index/communitycard?community_id="+e+"&pid="+i}},onShareTimeline:function(e){var i={};t.getStorageSync("user_id");return i.community_id=this.community_id,i.pid=this.user_id,{title:t.getStorageSync("user").user_nickname+"邀请你加入"+this.detail.title+"小区，与邻居们一起共建共享小区",imageUrl:this.detail.images&&this.detail.images.length?this.detail.images[0]:"https://sq.wenlinapp.com/appimg/send54.png",query:i}},computed:{headerHeight:function(){return 96},sheaderHeight:function(){return 250}},methods:{goHome:function(){t.navigateTo({url:"/pages/index/index"})},gosecret:function(){t.navigateTo({url:"/pages/update/secret"})},onsend:function(){this.onShareShow=!1,this.$refs.Firend.onshow()},onShowclose:function(){this.onShareShow=!1},onActivelink:function(){this.onShareShow=!0},onShowshare:function(){this.onShareShow=!1},openPicker:function(t){this.pickerId=!0},closePicker:function(t){this.pickerId=!1},pickerChange:function(t){var e=t.detail.value[0];this.pickerValue=e},pickerClick:function(t){this.setcommunityType=this.picker[this.pickerValue].value,this.setcommunityValue=this.picker[this.pickerValue].label,this.pickerId=!1},setcommunityClose:function(){this.setcommunity=!1},getmaps:function(){var e=this;t.getLocation({type:"wgs84",success:function(i){t.openLocation({latitude:parseFloat(e.detail.latitude),longitude:parseFloat(e.detail.longitude),name:"",address:e.detail.address})}})},getMap:function(){var e=this,i=new Promise((function(e,i){t.getStorageSync("longitude")||t.getLocation({success:function(e){t.setStorageSync("latitude",e.latitude),t.setStorageSync("longitude",e.longitude)},fail:function(t){console.log(t)}}),e()}));i.then((function(i){e.Api.getNearCommunity({latitude:t.getStorageSync("latitude"),longitude:t.getStorageSync("longitude")}).then((function(t){1==t.code&&(e.searchCommunityList=t.data,e.chooseCommunity=!0)}))}))},communityInput:function(t){this.community=t.detail.value},buildingInput:function(t){this.building=t.detail.value.replace(/[^a-z|0-9]/gi,"")},unitInput:function(t){this.unit=t.detail.value.replace(/[^a-z|0-9]/gi,"")},roomInput:function(t){this.room=t.detail.value.replace(/[^a-z|0-9]/gi,"")},setClose:function(){this.openCommunity=!1},getPhoneNumber:function(e){var i=this;console.log(e);var n=e.detail,o=n.encryptedData,a=n.iv;this.Api.setUserPhoneBySecret({encrypted_data:o,iv:a}).then((function(e){1==e.code&&(i.mobile=e.data,t.setStorageSync("mobile",e.data))}))},getAddress:function(){var e=this,i=new Promise((function(e,i){t.getStorageSync("longitude")||t.getLocation({success:function(e){t.setStorageSync("latitude",e.latitude),t.setStorageSync("longitude",e.longitude)},fail:function(t){console.log(t)}}),e()}));i.then((function(i){t.getStorageSync("longitude")?t.chooseLocation({latitude:t.getStorageSync("latitude"),longitude:t.getStorageSync("longitude"),success:function(t){e.communityAddress=t.address}}):t.showToast({title:"您未开通地图授权，请输入地址",duration:2e3})}))},communityAddressInput:function(t){this.communityAddress=t.detail.value},openCommunityHandler:function(){this.communityTitle?this.communityAddress?this.mobile?this.Api.communityOpening({title:this.communityTitle,address:this.communityAddress,contact_phone:this.mobile}).then((function(e){1==e.code?t.showToast({title:e.msg,duration:2e3,success:function(){t.navigateTo({url:"/pages/index/index"})}}):t.showToast({title:e.msg,duration:2e3})})):t.showToast({icon:"none",title:"请输入手机号",duration:2e3}):t.showToast({icon:"none",title:"请输入小区地址",duration:2e3}):t.showToast({icon:"none",title:"请输入小区名",duration:2e3})},getDetail:function(){var e=this,i={community_id:this.community_id};this.Api.communityDetail(i).then((function(i){1==i.code&&(e.detail=i.data,e.detail.logo=e.detail.logo?e.detail.logo:e.Config.minUrl+"logovi.jpg",e.communityTitle=i.data.title,e.communityAddress=i.data.address,e.detail.images.length||(e.detail.images=["https://sq.wenlinapp.com/appimg/send54.png"]),t.setStorageSync("pcommittee_id",i.data.committee_id),t.setStorageSync("ptitle",i.data.title),t.setStorageSync("paddress",i.data.address))}))},goJoin:function(){var e=this;if(1!=t.getStorageSync("singPage"))if(1==this.detail.is_join)this.onActivelink();else{var i=this,n=new Promise((function(e,n){t.login({success:function(n){var o=n.errMsg,a=n.code;"login:ok"==o&&i.Api.wechatAuth({code:a}).then((function(i){1==i.code&&(t.setStorageSync("token",i.data.token),t.setStorageSync("user",i.data.user),t.setStorageSync("maxJoin",i.data.max_join),t.setStorageSync("mobile",i.data.user.mobile),t.setStorageSync("all_community",i.data.all_community),e())}))}})}));n.then((function(i){if(t.getStorageSync("token")){var n=t.getStorageSync("all_community"),o=t.getStorageSync("maxJoin");console.log(JSON.stringify(n),"all"),console.log(e.detail.title,"title");var a=!1;if(n.map((function(t){t.title==e.detail.title&&(a=!0)})),a)return void t.showToast({title:"您已加入过本小区，不能重复加入",icon:"none",duration:2e3});if(o==n.length)return void t.showToast({title:"您最多只能加入"+o+"个小区",icon:"none",duration:2e3});e.setcommunity=!0,e.community=t.getStorageSync("ptitle"),e.community_id=t.getStorageSync("pcommunity_id")}else t.navigateTo({url:"/pages/index/index"})}))}else t.showToast({title:"请前往小程序使用完整服务",icon:"none",duration:2e3})},onShowtodo:function(){var e=this;this.onShareShow=!1,this.scrollFixed=!0;var i=getCurrentPages(),n=i[i.length-1];console.log(n.route);var o=t.getStorageSync("community_id"),a=t.getStorageSync("user_id"),s={scene:"community_id="+o+"&pid="+a,page:n.route};this.Api.getWXACodeUnlimit(s).then((function(i){1==i.code&&e.$nextTick((function(){e.posterData.posterImgUrl=e.detail.images.length?e.detail.images[0]:"https://sq.wenlinapp.com/appimg/share500400.jpg",e.posterData.avatarUrl=t.getStorageSync("user").avatar,e.posterData.posterCodeUrl=i.data,e.posterData.title=t.getStorageSync("user").user_nickname+"邀请你加入"+e.detail.title+"小区邻里互助平台",e.$forceUpdate(),setTimeout((function(){e.canvasFlag=!1,e.deliveryFlag=!1,e.$refs.hchPoster.posterShow()}),500)}))}))},canvasCancel:function(t){this.scrollFixed=!1,this.canvasFlag=t},setcommunityHandler:function(){var e=this;if(this.community_id)if(this.building)if(this.unit)if(this.room){var i={building:this.building,unit:this.unit,community_id:this.community_id,room:this.room,type:this.setcommunityType},n=this;this.Api.setUserCommunityInfo(i).then((function(i){1==i.code&&t.showToast({title:i.msg,duration:2e3,success:function(){t.setStorageSync("committee_id",i.data.committee_id),t.setStorageSync("community_id",i.data.community_id),t.setStorageSync("community_menu",e.communityTitle),n.setcommunity=!1;var o=t.getStorageSync("pid");if(o){var a={from_user_id:o};n.Api.inviteNeighbor(a).then((function(e){t.reLaunch({url:"/pages/index/index"})}))}else t.reLaunch({url:"/pages/index/index"})}})}))}else t.showToast({title:"请输入门牌号",icon:"none",duration:2e3});else t.showToast({title:"请输入单元号",icon:"none",duration:2e3});else t.showToast({title:"请输入楼栋号",icon:"none",duration:2e3});else t.showToast({title:"请选择小区",icon:"none",duration:2e3})}},components:{navigationCustom:s,hchPoster:a,Onshare:n,Firend:o}};e.default=c}).call(this,i("543d")["default"])},"6b1b":function(t,e,i){},"71f0":function(t,e,i){"use strict";var n=i("6b1b"),o=i.n(n);o.a},eb1d:function(t,e,i){"use strict";(function(t){i("4038");n(i("66fd"));var e=n(i("3ba6"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])}},[["eb1d","common/runtime","common/vendor"]]]);