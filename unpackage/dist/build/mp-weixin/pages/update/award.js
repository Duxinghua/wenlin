(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/update/award"],{"048c":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=r(n("a34a"));function r(t){return t&&t.__esModule?t:{default:t}}function o(t){return c(t)||s(t)||u(t)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){if(t){if("string"===typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}function s(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function c(t){if(Array.isArray(t))return d(t)}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function l(t,e,n,i,r,o,a){try{var u=t[o](a),s=u.value}catch(c){return void n(c)}u.done?e(s):Promise.resolve(s).then(i,r)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function a(t){l(o,i,r,a,u,"next",t)}function u(t){l(o,i,r,a,u,"throw",t)}a(void 0)}))}}var m=function(){Promise.all([n.e("common/vendor"),n.e("components/almost-lottery/almost-lottery")]).then(function(){return resolve(n("3785"))}.bind(null,n)).catch(n.oe)},p=function(){n.e("components/struggler-navigationCustom/navigation-custom").then(function(){return resolve(n("e7f2"))}.bind(null,n)).catch(n.oe)},h={components:{navigationCustom:p,AlmostLottery:m},data:function(){return{imgUrl:this.Config.minUrl,config:{title:"活动抽奖",bgcolor:"white",fontcolor:"rgba(51, 51, 51, 1)",type:1,transparent:!1,linear:!1,share:!1},scrollTop:0,scrollMaxHeight:200,status:["抽奖还没开始，请耐心等待","抽奖已开启"],statusValue:0,canvasData:{width:240,height:240},prizeList:[],prizeIndex:-1,prizeing:!1,targetName:"",onStock:!1,onFrontend:!1,weightTotal:0,weightArr:[],draw_id:0,community_id:0,show:!1,selectObj:null,rule:"",userList:[],detail:{has_draw_num:0,can_draw:0,draw_num:0}}},onLoad:function(e){this.draw_id=e.draw_id||1,this.community_id=e.community_id||t.getStorageSync("community_id"),this.getPrizeList()},onShow:function(){this.getList()},methods:{getList:function(){var t=this;return f(i.default.mark((function e(){var n,r;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={draw_id:t.draw_id,page:1,page_size:1e4},e.next=3,t.Api.drawUser(n);case 3:r=e.sent,1==r.code&&(t.userList=r.data.list);case 5:case"end":return e.stop()}}),e)})))()},handleInitCanvas:function(){clearCacheFile(),this.targetName="",this.prizeList=[],this.getPrizeList()},getPrizeList:function(){var e=this;return f(i.default.mark((function n(){var r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.showLoading({title:"奖品准备中..."}),n.next=3,e.Api.drawDetail({draw_id:e.draw_id});case 3:r=n.sent,console.log(r),1==r.code&&(e.statusValue=r.data.status,e.rule=r.data.rule,e.detail=r.data,r.data.prize_list.map((function(t){t.prizeImage=t.image,t.prizeId=t.prize_id,t.name=t.prize_name,t.stock=1e4,t.weight=0})),e.prizeList=r.data.prize_list);case 6:case"end":return n.stop()}}),n)})))()},requestPrizeList:function(){var t=this;return new Promise((function(e,n){var i=setTimeout((function(){clearTimeout(i),i=null,e({ok:!0,data:[{prizeId:1,name:"0.1元现金",stock:10,weight:0,prizeImage:t.Config.minUrl+"committe.jpg"},{prizeId:2,name:"10元现金",stock:0,weight:0,prizeImage:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-dc-site/56f085e0-bcfe-11ea-b244-a9f5e5565f30.png"},{prizeId:3,name:"5元话费",stock:1,weight:0},{prizeId:4,name:"50元现金",stock:0,weight:0},{prizeId:5,name:"1卷抽纸",stock:3,weight:0},{prizeId:6,name:"谢谢参与",stock:100,weight:0}]})}),2e3)}))},handleDrawStart:function(){var t=this;if(0==this.detail.can_draw)return this.$u.toast("您的抽奖次数已用完");if(!this.prizeing){this.prizeing=!0,this.targetName="";var e=o(this.prizeList);if(this.onFrontend);else var n=setTimeout((function(){clearTimeout(n),n=null,console.warn("###当前处于模拟的随机中奖概率，实际场景中，中奖概率应由后端控制###"),t.Api.gotoDraw({draw_id:t.draw_id,community_id:t.community_id}).then((function(n){if(1==n.code){console.log(n);for(var i=n.data.object.prize_id,r=0;r<e.length;r++){var o=e[r];if(o.prizeId===i){t.prizeIndex=r,t.selectObj=n.data,t.$forceUpdate();break}}t.getPrizeList(),t.show=!0,1==n.data.status&&t.getList()}}))}),500)}},handleDrawEnd:function(){this.prizeing=!1;var t=this.prizeList[this.prizeIndex].name;if(this.onStock){var e=this.prizeList[this.prizeIndex].stock;this.targetName="谢谢参与"===t?t:e?"恭喜您，获得 ".concat(t):"很抱歉，您来晚了，当前奖品已无库存"}this.targetName="谢谢参与"===t?t:"恭喜您，获得 ".concat(t)},handleDrawFinish:function(e){console.log("抽奖转盘绘制完成",e),t.showToast({title:e.msg,duration:2e3,mask:!0,icon:"none"})}},onUnload:function(){t.hideLoading()}};e.default=h}).call(this,n("543d")["default"])},2264:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i}));var i={almostLottery:function(){return Promise.all([n.e("common/vendor"),n.e("components/almost-lottery/almost-lottery")]).then(n.bind(null,"3785"))},uParse:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-parse/u-parse")]).then(n.bind(null,"849d"))},uPopup:function(){return n.e("uview-ui/components/u-popup/u-popup").then(n.bind(null,"b3a9"))},uIcon:function(){return n.e("uview-ui/components/u-icon/u-icon").then(n.bind(null,"3cb5"))},uImage:function(){return n.e("uview-ui/components/u-image/u-image").then(n.bind(null,"2a28"))}},r=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.prizeIndex=-1},t.e1=function(e){t.show=!1})},o=[]},"44db":function(t,e,n){"use strict";n.r(e);var i=n("2264"),r=n("9565");for(var o in r)"default"!==o&&function(t){n.d(e,t,(function(){return r[t]}))}(o);n("652b");var a,u=n("f0c5"),s=Object(u["a"])(r["default"],i["b"],i["c"],!1,null,"d8893d10",null,!1,i["a"],a);e["default"]=s.exports},"652b":function(t,e,n){"use strict";var i=n("772e"),r=n.n(i);r.a},"772e":function(t,e,n){},9565:function(t,e,n){"use strict";n.r(e);var i=n("048c"),r=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=r.a},f1d8:function(t,e,n){"use strict";(function(t){n("4038");i(n("66fd"));var e=i(n("44db"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])}},[["f1d8","common/runtime","common/vendor"]]]);