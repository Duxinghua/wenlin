(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["wxcomponents/hch-poster/hch-poster"],{2353:function(t,e,s){},4051:function(t,e,s){"use strict";var i=s("2353"),a=s.n(i);a.a},"497c":function(t,e,s){"use strict";var i;s.d(e,"b",(function(){return a})),s.d(e,"c",(function(){return n})),s.d(e,"a",(function(){return i}));var a=function(){var t=this,e=t.$createElement;t._self._c},n=[]},"7fed":function(t,e,s){"use strict";s.r(e);var i=s("9759"),a=s.n(i);for(var n in i)"default"!==n&&function(t){s.d(e,t,(function(){return i[t]}))}(n);e["default"]=a.a},9759:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(s("a34a"));function a(t){return t&&t.__esModule?t:{default:t}}function n(t,e,s,i,a,n,r){try{var o=t[n](r),c=o.value}catch(d){return void s(d)}o.done?e(c):Promise.resolve(c).then(i,a)}function r(t){return function(){var e=this,s=arguments;return new Promise((function(i,a){var r=t.apply(e,s);function o(t){n(r,i,a,o,c,"next",t)}function c(t){n(r,i,a,o,c,"throw",t)}o(void 0)}))}}var o={data:function(){return{canvasShow:!1,attrs:{marginLR:40,marginTB:40,radius:.03,fillColor:"#ffffff",innerLR:20,innerTB:20,posterRatio:1.3,posterImgUrl:"https://huangchunhongzz.gitee.io/imgs/poster/product.png",title:"今日上新水果，牛奶草莓，颗粒饱满，每盒 200g",titleFontSize:16,titleLineHeight:25,posterCodeUrl:"https://huangchunhongzz.gitee.io/imgs/poster/code.png",codeWidth:.3,codeRatio:1,codeRadius:.5,codeMT:20,codeName:"记忆之王",codeNameMT:20,tips:"长按/扫描识别查看商品",posterBgUrl:"https://huangchunhongzz.gitee.io/imgs/poster/poster_bg_3.png",codeML:140,desTextMT:70,desTextML:240}}},props:{canvasAttr:{type:Object,default:{marginLR:40,marginTB:40,radius:.03,fillColor:"#ffffff",innerLR:20,innerTB:20,posterRatio:1.3,posterImgUrl:"https://huangchunhongzz.gitee.io/imgs/poster/product.png",title:"今日上新水果，牛奶草莓，颗粒饱满，每盒 200g",titleFontSize:16,titleLineHeight:25,posterCodeUrl:"https://huangchunhongzz.gitee.io/imgs/poster/code.png",codeWidth:.3,codeRatio:1,codeRadius:.5,codeMT:20,codeName:"记忆之王",codeNameMT:20,tips:"长按/扫描识别查看商品",posterBgUrl:"https://huangchunhongzz.gitee.io/imgs/poster/poster_bg_3.png",codeML:140,desTextMT:70,desTextML:240,avatarUrl:"",des:""}},posterBgFlag:{type:Boolean,default:!1},simpleFlag:{type:Boolean,default:!1}},mounted:function(){this.system=this.getSystem()},methods:{posterShow:function(){this.canvasShow=!0,Object.assign(this.attrs,this.canvasAttr),this.attrs={marginLR:this.attrs.marginLR*this.systemScale,marginTB:this.attrs.marginTB*this.systemScale,innerLR:this.attrs.innerLR*this.systemScale,innerTB:this.attrs.innerTB*this.systemScale,radius:this.attrs.radius,fillColor:this.attrs.fillColor,posterRatio:this.attrs.posterRatio,posterImgUrl:this.attrs.posterImgUrl,title:this.attrs.title,des:this.attrs.des,desFontSize:this.attrs.desFontSize,desLineHeight:this.attrs.desLineHeight,titleFontSize:this.attrs.titleFontSize*this.systemScale,titleLineHeight:this.attrs.titleLineHeight*this.systemScale,posterCodeUrl:this.attrs.posterCodeUrl,codeWidth:this.attrs.codeWidth*this.systemScale,codeRatio:this.attrs.codeRatio,codeRadius:this.attrs.codeRadius,codeMT:this.attrs.codeMT*this.systemScale,codeName:this.attrs.codeName,codeNameMT:this.attrs.codeNameMT*this.systemScale,tips:this.attrs.tips,posterBgUrl:this.attrs.posterBgUrl,codeML:this.attrs.codeML*this.systemScale,desTextMT:this.attrs.desTextMT*this.systemScale,desTextML:this.attrs.desTextML*this.systemScale},this.simpleFlag?this.creatSimplePoster(this.attrs):this.creatPoster(this.attrs)},creatPoster:function(t){var e=this;return r(i.default.mark((function s(){var a,n,r,o;return i.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(wx.showLoading({title:"生成海报中..."}),a=wx.createCanvasContext("myCanvas",e),a.draw(),e.roundRect(a,t.marginLR,t.marginTB,e.system.w-2*t.marginLR,e.scale*e.system.w-2*t.marginTB-30,(e.system.w-2*t.marginLR)*t.radius,t.fillColor),!e.posterBgFlag){s.next=7;break}return s.next=7,e.creatBgImg(a,t);case 7:return n=e,r=(n.system.w-t.innerLR)/t.posterRatio-2,e.creatAvatarCode(a,t,r),console.log(t.des,"des"),e.creatDes(a,t),s.next=14,e.creatImg(a,t);case 14:s.sent,o=e.creatTitle(a,t),e.creatCode(a,t,o),e.creatCodeText(a,t,t.codeName,o,16,"#2f1709"),e.creatCodeText(a,t,t.tips,o+30,14,"#2f1709"),wx.hideLoading();case 20:case"end":return s.stop()}}),s)})))()},creatSimplePoster:function(t){var e=this;return r(i.default.mark((function s(){var a;return i.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(wx.showLoading({title:"生成海报中..."}),a=wx.createCanvasContext("myCanvas",e),a.draw(),e.roundRect(a,t.marginLR,t.marginTB,e.system.w-2*t.marginLR,e.scale*e.system.w-2*t.marginTB-30,(e.system.w-2*t.marginLR)*t.radius,t.fillColor),!e.posterBgFlag){s.next=7;break}return s.next=7,e.creatBgImg(a,t);case 7:e.creatSimpleCode(a,t,t.marginTB),e.creatVerticalTitle(a,t),wx.hideLoading();case 10:case"end":return s.stop()}}),s)})))()},roundRect:function(t,e,s,i,a,n){t.save(),t.beginPath(),t.arc(e+n,s+n,n,Math.PI,1.5*Math.PI),t.lineTo(e+i-n,s),t.arc(e+i-n,s+n,n,1.5*Math.PI,2*Math.PI),t.lineTo(e+i,s+a-n),t.arc(e+i-n,s+a-n,n,0,.5*Math.PI),t.arc(e+n,s+a-n,n,.5*Math.PI,Math.PI),t.lineTo(e,s+n),t.setFillStyle("#ffffff"),t.fill(),t.clip()},headerroundRect:function(t,e,s,i,a,n){t.save(),t.beginPath(),t.arc(e+n,s+n,n,Math.PI,1.5*Math.PI),t.lineTo(e+i-n,s),t.arc(e+i-n,s+n,n,1.5*Math.PI,2*Math.PI),t.lineTo(e+i,s+a-n),t.arc(e+i-n,s+a+n,n,0,.5*Math.PI),t.arc(e+n,s+a+n,n,.5*Math.PI,Math.PI),t.lineTo(e,s+n),t.setFillStyle("#ffffff"),t.fill(),t.clip()},getSystem:function(){var t=wx.getSystemInfoSync();return this.scale=667/375,this.systemScale=t.windowWidth/375,{w:t.windowWidth,h:t.windowHeight}},creatBgImg:function(e,s){var i=this;return new Promise((function(a,n){wx.getImageInfo({src:s.posterBgUrl,success:function(t){t.width,i.system.w,s.marginLR;e.drawImage(t.path,s.marginLR,s.marginTB,i.system.w-2*s.marginLR,i.scale*i.system.w-2*s.marginTB-60),e.restore(),e.draw(!0),a()},fail:function(e){console.log("fail -> res",e),t.showToast({title:"海报背景图下载异常",duration:2e3,icon:"none"})}})}))},creatImg:function(e,s){var i=this;return new Promise((function(a,n){wx.getImageInfo({src:s.posterImgUrl,success:function(t){e.restore(),e.draw(!0);var n=t,r=t.width/(i.system.w-2*s.marginLR-2*s.innerLR);i.headerroundRect(e,s.marginLR,s.marginTB,i.system.w-2*s.marginLR,(i.system.w-2*s.marginLR-2*s.innerLR)/s.posterRatio,(i.system.w-2*s.marginLR)*s.radius),e.drawImage(t.path,s.marginLR,s.marginTB,i.system.w-2*s.marginLR,(i.system.w-2*s.marginLR-2*s.innerLR)/s.posterRatio),e.restore(),e.draw(!0),a({imgAttr:n,sale:r})},fail:function(e){console.log("fail -> res",e),t.showToast({title:"海报主图下载异常",duration:2e3,icon:"none"})}})}))},creatTitle:function(t,e){t.restore(),t.save(),t.setFontSize(e.titleFontSize);var s=30,i=this.drawText(t,e.title,e.marginLR+e.innerLR,s+(this.system.w-2*e.marginLR-2*e.innerLR)/e.posterRatio+2*e.innerLR+e.marginTB,this.system.w-2*e.marginLR-2*e.innerLR,e.titleLineHeight);return t.draw(!0),i},creatDes:function(t,e){t.restore(),t.save(),t.setFontSize(e.desFontSize);var s=.08*this.system.w,i=this.drawText(t,e.des,e.marginLR+e.innerLR+s,(this.system.w-2*e.marginLR-2*e.innerLR)/e.posterRatio+2*e.innerLR+e.marginTB-5,this.system.w-2*e.marginLR-2*e.innerLR,e.desLineHeight);return t.draw(!0),i},creatVerticalTitle:function(t,e){var s=this;t.restore(),t.save(),t.setFontSize(e.titleFontSize),e.title.forEach((function(i,a){s.drawText(t,i,e.marginTB+e.desTextML+20*a,e.marginLR+e.desTextMT,15,e.titleLineHeight)})),t.draw(!0)},drawText:function(t,e,s,i){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:375,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,r=(t.canvas,e.split("")),o="",c=0;c<r.length;c++){var d=o+r[c],h=t.measureText(d),l=h.width;l>a&&c>0?(t.fillText(o,s,i),o=r[c],i+=n):o=d}return t.fillText(o,s,i),i},creatCodeText:function(t,e,s,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#2f1709";t.setFontSize(a),t.setFillStyle(n);var r=t.measureText(s),o=r.width;t.fillText(s,(this.system.w-o)/2,i+e.codeMT+this.system.w*e.codeWidth+e.codeNameMT+10)},creatTextLine:function(){},creatCode:function(e,s,i){var a=this;wx.getImageInfo({src:s.posterCodeUrl,success:function(t){e.restore(),e.draw(!0),a.roundRect(e,(a.system.w-a.system.w*s.codeWidth)/2,i+s.codeMT,a.system.w*s.codeWidth,a.system.w*s.codeWidth*s.codeRatio,a.system.w*s.codeWidth*s.codeRatio*s.codeRadius),e.drawImage(t.path,(a.system.w-a.system.w*s.codeWidth)/2,i+s.codeMT,a.system.w*s.codeWidth,a.system.w*s.codeWidth*s.codeRatio),e.restore(),e.draw(!0)},fail:function(){t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}})},creatAvatarCode:function(e,s,i){var a=t.getStorageSync("user").avatar+"",n=this;setTimeout((function(){wx.getImageInfo({src:a,success:function(t){e.restore(),e.draw(!0),n.roundRect(e,s.marginLR+s.innerLR,25+i+s.codeMT,.06*n.system.w,.06*n.system.w*s.codeRatio,.06*n.system.w*s.codeRatio*s.codeRadius),e.drawImage(t.path,s.marginLR+s.innerLR,25+i+s.codeMT,.06*n.system.w,.06*n.system.w*s.codeRatio),e.restore(),e.draw(!0)},fail:function(){t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}})}),500)},creatSimpleCode:function(e,s){var i=this;wx.getImageInfo({src:s.posterCodeUrl,success:function(t){e.restore(),e.draw(!0),i.roundRect(e,s.marginLR+s.codeML,s.marginTB+s.codeMT,i.system.w*s.codeWidth,i.system.w*s.codeWidth*s.codeRatio,i.system.w*s.codeWidth*s.codeRatio*s.codeRadius),e.drawImage(t.path,s.marginLR+s.codeML,s.marginTB+s.codeMT,i.system.w*s.codeWidth,i.system.w*s.codeWidth*s.codeRatio),e.restore(),e.draw(!0)},fail:function(){t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}})},handleSaveCanvasImage:function(){var e=this.attrs;wx.showLoading({title:"保存中..."});var s=this;t.canvasToTempFilePath({x:e.marginLR,y:e.marginTB,width:this.system.w-2*e.marginLR,height:this.scale*this.system.w-2*e.marginTB-30,destWidth:5*(this.system.w-2*e.marginLR),destHeight:5*(this.scale*this.system.w-2*e.marginTB-30),canvasId:"myCanvas",success:function(e){t.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(e){wx.hideLoading(),t.showToast({title:"图片保存成功，可以去分享啦~",duration:2e3,icon:"none"}),s.handleCanvasCancel()},fail:function(){t.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}})},fail:function(e){console.log("fail -> res",e),t.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}},this)},handleCanvasCancel:function(){this.canvasShow=!1,this.$emit("cancel",!0)}}};e.default=o}).call(this,s("543d")["default"])},b7f5:function(t,e,s){"use strict";s.r(e);var i=s("497c"),a=s("7fed");for(var n in a)"default"!==n&&function(t){s.d(e,t,(function(){return a[t]}))}(n);s("4051");var r,o=s("f0c5"),c=Object(o["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],r);e["default"]=c.exports}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'wxcomponents/hch-poster/hch-poster-create-component',
    {
        'wxcomponents/hch-poster/hch-poster-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("b7f5"))
        })
    },
    [['wxcomponents/hch-poster/hch-poster-create-component']]
]);
